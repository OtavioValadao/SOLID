# Princ√≠pio da Responsabilidade √önica (SRP)
## Single Responsibility Principle - Guia Completo

![SOLID Principles](https://img.shields.io/badge/SOLID-SRP-blue)
![Clean Code](https://img.shields.io/badge/Clean%20Code-Best%20Practices-green)

---

## üìã Sum√°rio

1. [Defini√ß√£o Abrangente do SRP](#1-defini√ß√£o-abrangente-do-srp)
2. [Diretrizes de Implementa√ß√£o](#2-diretrizes-de-implementa√ß√£o)
3. [Exemplos Pr√°ticos e Use Cases](#3-exemplos-pr√°ticos-e-use-cases)
4. [Caso Real: Refactoring de God Object](#4-caso-real-refactoring-de-god-object)
5. [Abstra√ß√µes Conceituais](#5-abstra√ß√µes-conceituais)
6. [SRP e os Princ√≠pios SOLID](#6-srp-e-os-princ√≠pios-solid)
7. [Armadilhas Comuns](#7-armadilhas-comuns)
8. [Impacto na Qualidade do Software](#8-impacto-na-qualidade-do-software)

---

## 1. Defini√ß√£o Abrangente do SRP

### 1.1 O Conceito Fundamental

> **"Uma classe deve ter apenas uma raz√£o para mudar."** - Robert C. Martin

O Princ√≠pio da Responsabilidade √önica estabelece que cada m√≥dulo, classe ou fun√ß√£o deve ter **responsabilidade sobre uma √∫nica parte da funcionalidade** do software, e essa responsabilidade deve estar **completamente encapsulada** pela classe.

### 1.2 Entendendo "Uma Responsabilidade"

Uma **responsabilidade** n√£o √© simplesmente "fazer uma coisa", mas sim:

- **Servir a um √∫nico ator ou stakeholder** do sistema
- **Responder a uma √∫nica fonte de mudan√ßas** nos requisitos de neg√≥cio
- **Encapsular uma √∫nica raz√£o para existir** no contexto da aplica√ß√£o

**Exemplo conceitual:**

```
‚ùå Responsabilidade M√∫ltipla:
   "Gerenciar dados do funcion√°rio, calcular sal√°rio e gerar relat√≥rios"
   
‚úÖ Responsabilidade √önica:
   "Representar as informa√ß√µes b√°sicas de um funcion√°rio"
```

### 1.3 O Crit√©rio: "Um Motivo Para Mudar"

Uma classe possui mais de uma responsabilidade quando existem **m√∫ltiplos motivos independentes** que poderiam exigir sua modifica√ß√£o:

| Cen√°rio | Motivos para Mudar | An√°lise |
|---------|-------------------|---------|
| Classe `Employee` que calcula sal√°rio E formata relat√≥rio | 1. Mudan√ßa na regra de c√°lculo<br>2. Mudan√ßa no formato do relat√≥rio | ‚ùå Viola SRP |
| Classe `Employee` que apenas armazena dados | 1. Mudan√ßa nos atributos do funcion√°rio | ‚úÖ Segue SRP |

---

## 2. Diretrizes de Implementa√ß√£o

### 2.1 Identificando M√∫ltiplas Responsabilidades

#### Sinais de Alerta (Code Smells)

1. **Nomes de classe com "E" (AND)**: `UserAndOrderManager`
2. **M√©todos n√£o relacionados**: classe com `saveToDatabase()` e `sendEmail()`
3. **Depend√™ncias excessivas**: muitos imports de bibliotecas diferentes
4. **Tamanho excessivo**: classes com mais de 200-300 linhas
5. **M√∫ltiplos n√≠veis de abstra√ß√£o**: m√©todos muito t√©cnicos misturados com l√≥gica de neg√≥cio

#### T√©cnica: An√°lise de Stakeholders

Pergunte: **"Quem solicitaria mudan√ßas nesta classe?"**

```
Classe: RelatorioPedido

Stakeholders identificados:
- Equipe de TI (persist√™ncia de dados)
- Equipe Financeira (c√°lculos de impostos)
- Equipe de Marketing (formato dos relat√≥rios)
- Equipe de Log√≠stica (valida√ß√£o de endere√ßos)

Conclus√£o: 4 stakeholders = 4 responsabilidades = VIOLA SRP
```

### 2.2 Benef√≠cios da Alta Coes√£o

**Coes√£o** √© o grau em que os elementos de um m√≥dulo pertencem juntos. O SRP promove **alta coes√£o funcional**.

#### Benef√≠cios Diretos:

- **Manutenibilidade**: mudan√ßas isoladas, menor risco de efeitos colaterais
- **Testabilidade**: testes mais simples e focados
- **Reusabilidade**: componentes especializados s√£o mais reutiliz√°veis
- **Compreensibilidade**: c√≥digo mais f√°cil de entender
- **Paraleliza√ß√£o**: equipes podem trabalhar em classes diferentes simultaneamente

---

## 3. Exemplos Pr√°ticos e Use Cases

### 3.1 Separa√ß√£o: Persist√™ncia vs L√≥gica de Neg√≥cios

#### ‚ùå Violando o SRP

```java
public class Usuario {
    private String nome;
    private String email;
    private String senha;
    
    // L√≥gica de Neg√≥cio
    public boolean validarSenha(String senha) {
        return this.senha.length() >= 8 && 
               senha.matches(".*[A-Z].*") && 
               senha.matches(".*[0-9].*");
    }
    
    // Persist√™ncia
    public void salvar() {
        Connection conn = DriverManager.getConnection("jdbc:mysql://...");
        PreparedStatement stmt = conn.prepareStatement(
            "INSERT INTO usuarios (nome, email, senha) VALUES (?, ?, ?)"
        );
        stmt.setString(1, this.nome);
        stmt.setString(2, this.email);
        stmt.setString(3, this.senha);
        stmt.execute();
        conn.close();
    }
    
    // Formata√ß√£o de Sa√≠da
    public String gerarRelatorioHTML() {
        return "<div>" +
               "<h2>" + this.nome + "</h2>" +
               "<p>Email: " + this.email + "</p>" +
               "</div>";
    }
}
```

**Problemas:**
- Mudan√ßa no banco de dados afeta a classe `Usuario`
- Mudan√ßa no formato HTML afeta a classe `Usuario`
- Imposs√≠vel testar l√≥gica de neg√≥cio sem banco de dados
- Viola√ß√£o do princ√≠pio de separa√ß√£o de concerns

#### ‚úÖ Seguindo o SRP

```java
// RESPONSABILIDADE: Representar um usu√°rio (Entidade de Dom√≠nio)
public class Usuario {
    private String nome;
    private String email;
    private String senha;
    
    public Usuario(String nome, String email, String senha) {
        this.nome = nome;
        this.email = email;
        this.senha = senha;
    }
    
    // Apenas getters
    public String getNome() { return nome; }
    public String getEmail() { return email; }
    public String getSenha() { return senha; }
}

// RESPONSABILIDADE: Validar regras de neg√≥cio de senha
public class ValidadorSenha {
    private static final int TAMANHO_MINIMO = 8;
    
    public boolean validar(String senha) {
        return senha.length() >= TAMANHO_MINIMO &&
               contemMaiuscula(senha) &&
               contemNumero(senha);
    }
    
    private boolean contemMaiuscula(String senha) {
        return senha.matches(".*[A-Z].*");
    }
    
    private boolean contemNumero(String senha) {
        return senha.matches(".*[0-9].*");
    }
}

// RESPONSABILIDADE: Persistir usu√°rios no banco de dados
public class UsuarioRepository {
    private Connection connection;
    
    public UsuarioRepository(Connection connection) {
        this.connection = connection;
    }
    
    public void salvar(Usuario usuario) {
        try {
            PreparedStatement stmt = connection.prepareStatement(
                "INSERT INTO usuarios (nome, email, senha) VALUES (?, ?, ?)"
            );
            stmt.setString(1, usuario.getNome());
            stmt.setString(2, usuario.getEmail());
            stmt.setString(3, usuario.getSenha());
            stmt.execute();
        } catch (SQLException e) {
            throw new RuntimeException("Erro ao salvar usu√°rio", e);
        }
    }
}

// RESPONSABILIDADE: Formatar usu√°rio como HTML
public class UsuarioHTMLFormatter {
    public String formatarComoHTML(Usuario usuario) {
        return String.format(
            "<div><h2>%s</h2><p>Email: %s</p></div>",
            usuario.getNome(),
            usuario.getEmail()
        );
    }
}
```

**Benef√≠cios alcan√ßados:**
- Cada classe tem uma √∫nica raz√£o para mudar
- F√°cil substituir banco de dados sem tocar na entidade
- F√°cil adicionar novos formatos (JSON, XML) sem tocar na entidade
- Regras de valida√ß√£o podem ser testadas isoladamente

### 3.2 Use Case: Sistema de Processamento de Pedidos

#### ‚ùå Violando o SRP

```java
cimport java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.List;

class Cliente {
    private int id;
    private String email;

    public Cliente(int id, String email) {
        this.id = id;
        this.email = email;
    }

    public int getId() {
        return id;
    }

    public String getEmail() {
        return email;
    }
}

class Item {
    private double preco;
    private int quantidade;

    public Item(double preco, int quantidade) {
        this.preco = preco;
        this.quantidade = quantidade;
    }

    public double getPreco() {
        return preco;
    }

    public int getQuantidade() {
        return quantidade;
    }
}

class Pedido {
    private int id;
    private Cliente cliente;
    private List<Item> items;

    public Pedido(int id, Cliente cliente, List<Item> items) {
        this.id = id;
        this.cliente = cliente;
        this.items = items;
    }

    public int getId() {
        return id;
    }

    public Cliente getCliente() {
        return cliente;
    }

    public List<Item> getItems() {
        return items;
    }
}

class ProcessadorPedido {
    public double processarPedido(Pedido pedido) throws SQLException {
        // Valida√ß√£o
        if (pedido.getItems() == null || pedido.getItems().isEmpty()) {
            throw new IllegalArgumentException("Pedido vazio");
        }

        // C√°lculo
        double total = 0;
        for (Item item : pedido.getItems()) {
            total += item.getPreco() * item.getQuantidade();
        }

        // Desconto
        if (total > 1000) {
            total *= 0.9;
        }

        // Imposto
        total *= 1.15;

        // Persist√™ncia
        try (Connection conn = DriverManager.getConnection("jdbc:sqlite:pedidos.db")) {
            String sql = "INSERT INTO pedidos (cliente_id, total) VALUES (?, ?)";
            try (PreparedStatement stmt = conn.prepareStatement(sql)) {
                stmt.setInt(1, pedido.getCliente().getId());
                stmt.setDouble(2, total);
                stmt.executeUpdate();
            }
        }

        // Notifica√ß√£o (simula√ß√£o)
        enviarEmail(pedido.getCliente().getEmail(), "Pedido confirmado: R$ " + total);

        // Log
        System.out.println("Pedido " + pedido.getId() + " processado com sucesso");

        return total;
    }

    private void enviarEmail(String email, String mensagem) {
        // Aqui seria a implementa√ß√£o real de envio de e-mail
        System.out.println("Enviando email para " + email + ": " + mensagem);
    }
}

```

#### ‚úÖ Seguindo o SRP

```python
# RESPONSABILIDADE: Validar pedidos
class ValidadorPedido:
    def validar(self, pedido):
        if not pedido.items:
            raise ValueError("Pedido n√£o pode estar vazio")
        
        for item in pedido.items:
            if item.quantidade <= 0:
                raise ValueError("Quantidade deve ser positiva")

# RESPONSABILIDADE: Calcular valores
class CalculadoraPedido:
    def calcular_subtotal(self, items):
        return sum(item.preco * item.quantidade for item in items)
    
    def aplicar_desconto(self, valor, porcentagem):
        return valor * (1 - porcentagem / 100)
    
    def aplicar_imposto(self, valor, taxa):
        return valor * (1 + taxa / 100)

# RESPONSABILIDADE: Aplicar regras de desconto
class ServicoDesconto:
    def calcular_desconto(self, valor_total):
        if valor_total > 1000:
            return 10  # 10% de desconto
        return 0

# RESPONSABILIDADE: Persistir pedidos
class RepositorioPedido:
    def __init__(self, connection):
        self.connection = connection
    
    def salvar(self, pedido):
        cursor = self.connection.cursor()
        cursor.execute(
            "INSERT INTO pedidos (cliente_id, total) VALUES (?, ?)",
            (pedido.cliente_id, pedido.total)
        )
        self.connection.commit()

# RESPONSABILIDADE: Enviar notifica√ß√µes
class ServicoNotificacao:
    def notificar_pedido_confirmado(self, cliente, total):
        self.enviar_email(
            cliente.email,
            "Pedido Confirmado",
            f"Seu pedido foi confirmado. Total: R$ {total:.2f}"
        )
    
    def enviar_email(self, destinatario, assunto, corpo):
        # Implementa√ß√£o de envio de email
        pass

# RESPONSABILIDADE: Registrar logs
class LoggerPedido:
    def log_sucesso(self, pedido_id):
        print(f"[INFO] Pedido {pedido_id} processado com sucesso")
    
    def log_erro(self, pedido_id, erro):
        print(f"[ERRO] Falha ao processar pedido {pedido_id}: {erro}")

# RESPONSABILIDADE: Orquestrar o processo (Use Case)
class ProcessadorPedido:
    def __init__(self, validador, calculadora, servico_desconto, 
                 repositorio, notificacao, logger):
        self.validador = validador
        self.calculadora = calculadora
        self.servico_desconto = servico_desconto
        self.repositorio = repositorio
        self.notificacao = notificacao
        self.logger = logger
    
    def processar(self, pedido):
        try:
            self.validador.validar(pedido)
            
            subtotal = self.calculadora.calcular_subtotal(pedido.items)
            desconto = self.servico_desconto.calcular_desconto(subtotal)
            total_com_desconto = self.calculadora.aplicar_desconto(
                subtotal, desconto
            )
            total_final = self.calculadora.aplicar_imposto(
                total_com_desconto, 15
            )
            
            pedido.total = total_final
            self.repositorio.salvar(pedido)
            self.notificacao.notificar_pedido_confirmado(
                pedido.cliente, total_final
            )
            self.logger.log_sucesso(pedido.id)
            
            return total_final
            
        except Exception as e:
            self.logger.log_erro(pedido.id, str(e))
            raise
```

---

## 4. Caso Real: Refactoring de God Object

### 4.1 Identificando o "God Object"

Um **God Object** (ou **Blob Class**) √© uma classe que conhece ou faz demais, centralizando grande parte da l√≥gica da aplica√ß√£o.

#### ‚ùå Exemplo: God Object em Sistema de E-commerce

```typescript
class GerenciadorEcommerce {
    private produtos: Produto[] = [];
    private usuarios: Usuario[] = [];
    private pedidos: Pedido[] = [];
    private conexaoDB: Database;
    private emailService: any;
    private pagamentoAPI: any;
    
    // Gest√£o de Produtos
    adicionarProduto(produto: Produto) { /*...*/ }
    removerProduto(id: string) { /*...*/ }
    atualizarEstoque(id: string, quantidade: number) { /*...*/ }
    buscarProduto(id: string): Produto { /*...*/ }
    listarProdutosPorCategoria(categoria: string): Produto[] { /*...*/ }
    aplicarDesconto(id: string, percentual: number) { /*...*/ }
    
    // Gest√£o de Usu√°rios
    registrarUsuario(dados: any) { /*...*/ }
    autenticarUsuario(email: string, senha: string) { /*...*/ }
    atualizarPerfil(id: string, dados: any) { /*...*/ }
    validarCPF(cpf: string): boolean { /*...*/ }
    verificarEmailDuplicado(email: string): boolean { /*...*/ }
    
    // Gest√£o de Pedidos
    criarPedido(usuarioId: string, items: any[]) { /*...*/ }
    calcularTotal(items: any[]): number { /*...*/ }
    calcularFrete(cep: string): number { /*...*/ }
    aplicarCupomDesconto(codigo: string): number { /*...*/ }
    validarEstoqueDisponivel(items: any[]): boolean { /*...*/ }
    
    // Pagamento
    processarPagamentoCartao(dados: any) { /*...*/ }
    processarPagamentoBoleto(dados: any) { /*...*/ }
    processarPagamentoPix(dados: any) { /*...*/ }
    validarCartao(numero: string): boolean { /*...*/ }
    
    // Notifica√ß√µes
    enviarEmailConfirmacao(email: string, pedido: Pedido) { /*...*/ }
    enviarSMS(telefone: string, mensagem: string) { /*...*/ }
    enviarNotificacaoPush(usuarioId: string, mensagem: string) { /*...*/ }
    
    // Relat√≥rios
    gerarRelatorioVendas(dataInicio: Date, dataFim: Date) { /*...*/ }
    gerarRelatorioProdutosMaisVendidos() { /*...*/ }
    exportarRelatorioCSV(dados: any[]) { /*...*/ }
    
    // Persist√™ncia
    salvarNoBanco(entidade: any, tabela: string) { /*...*/ }
    buscarNoBanco(id: string, tabela: string) { /*...*/ }
    atualizarNoBanco(id: string, dados: any, tabela: string) { /*...*/ }
    
    // Logs e Auditoria
    registrarLog(acao: string, usuario: string) { /*...*/ }
    registrarAuditoria(entidade: string, acao: string) { /*...*/ }
}
```

**Problemas identificados:**

1. **Mais de 1000 linhas de c√≥digo**
2. **Pelo menos 8 responsabilidades distintas**
3. **M√∫ltiplos stakeholders** (TI, Financeiro, Marketing, Log√≠stica, etc.)
4. **Imposs√≠vel testar isoladamente**
5. **Alto acoplamento** entre funcionalidades n√£o relacionadas
6. **Dif√≠cil manuten√ß√£o** (qualquer mudan√ßa afeta toda a classe)

### 4.2 Processo de Refactoring

#### Passo 1: Identificar Responsabilidades

| Responsabilidade | M√©todos Relacionados | Stakeholder |
|-----------------|---------------------|-------------|
| Gest√£o de Produtos | adicionarProduto, removerProduto, etc. | Equipe de Produtos |
| Gest√£o de Usu√°rios | registrarUsuario, autenticar, etc. | Equipe de Seguran√ßa |
| Gest√£o de Pedidos | criarPedido, calcularTotal, etc. | Equipe de Vendas |
| Processamento de Pagamento | processarPagamento*, validarCartao | Equipe Financeira |
| Notifica√ß√µes | enviarEmail, enviarSMS, etc. | Equipe de Comunica√ß√£o |
| Relat√≥rios | gerarRelatorio*, exportar* | Equipe de BI |
| Persist√™ncia | salvarNoBanco, buscarNoBanco, etc. | Equipe de TI |
| Auditoria | registrarLog, registrarAuditoria | Equipe de Compliance |

#### Passo 2: Extrair Classes Especializadas

```typescript
// RESPONSABILIDADE: Gerenciar cat√°logo de produtos
class CatalogoProdutos {
    constructor(private repositorio: ProdutoRepository) {}
    
    adicionar(produto: Produto): void {
        this.repositorio.salvar(produto);
    }
    
    remover(id: string): void {
        this.repositorio.remover(id);
    }
    
    buscar(id: string): Produto {
        return this.repositorio.buscarPorId(id);
    }
    
    listarPorCategoria(categoria: string): Produto[] {
        return this.repositorio.buscarPorCategoria(categoria);
    }
}

// RESPONSABILIDADE: Gerenciar estoque
class GerenciadorEstoque {
    constructor(private repositorio: EstoqueRepository) {}
    
    atualizar(produtoId: string, quantidade: number): void {
        const estoque = this.repositorio.buscarPorProduto(produtoId);
        estoque.quantidade = quantidade;
        this.repositorio.atualizar(estoque);
    }
    
    verificarDisponibilidade(items: ItemPedido[]): boolean {
        return items.every(item => {
            const estoque = this.repositorio.buscarPorProduto(item.produtoId);
            return estoque.quantidade >= item.quantidade;
        });
    }
    
    reservar(items: ItemPedido[]): void {
        items.forEach(item => {
            const estoque = this.repositorio.buscarPorProduto(item.produtoId);
            estoque.quantidade -= item.quantidade;
            this.repositorio.atualizar(estoque);
        });
    }
}

// RESPONSABILIDADE: Autenticar e gerenciar usu√°rios
class ServicoAutenticacao {
    constructor(
        private repositorio: UsuarioRepository,
        private hasher: PasswordHasher,
        private tokenService: TokenService
    ) {}
    
    registrar(dados: DadosRegistro): Usuario {
        this.validarDados(dados);
        const senhaHash = this.hasher.hash(dados.senha);
        const usuario = new Usuario(dados.nome, dados.email, senhaHash);
        return this.repositorio.salvar(usuario);
    }
    
    autenticar(email: string, senha: string): string {
        const usuario = this.repositorio.buscarPorEmail(email);
        if (!usuario || !this.hasher.verificar(senha, usuario.senhaHash)) {
            throw new Error('Credenciais inv√°lidas');
        }
        return this.tokenService.gerar(usuario.id);
    }
    
    private validarDados(dados: DadosRegistro): void {
        if (!this.validarEmail(dados.email)) {
            throw new Error('Email inv√°lido');
        }
        if (this.repositorio.existeEmail(dados.email)) {
            throw new Error('Email j√° cadastrado');
        }
    }
    
    private validarEmail(email: string): boolean {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
}

// RESPONSABILIDADE: Calcular valores de pedidos
class CalculadoraPedido {
    calcularSubtotal(items: ItemPedido[]): number {
        return items.reduce(
            (total, item) => total + (item.preco * item.quantidade),
            0
        );
    }
    
    calcularFrete(cep: string, peso: number): number {
        // L√≥gica de c√°lculo de frete
        const distancia = this.calcularDistancia(cep);
        return (distancia * 0.5) + (peso * 0.3);
    }
    
    aplicarDesconto(valor: number, cupom: Cupom): number {
        if (cupom.tipo === 'PERCENTUAL') {
            return valor * (1 - cupom.valor / 100);
        }
        return valor - cupom.valor;
    }
    
    private calcularDistancia(cep: string): number {
        // Implementa√ß√£o
        return 100;
    }
}

// RESPONSABILIDADE: Processar diferentes tipos de pagamento
interface ProcessadorPagamento {
    processar(dados: DadosPagamento): ResultadoPagamento;
}

class ProcessadorCartaoCredito implements ProcessadorPagamento {
    processar(dados: DadosPagamento): ResultadoPagamento {
        // Integra√ß√£o com gateway de pagamento
        return { sucesso: true, transacaoId: 'xxx' };
    }
    
    private validarCartao(numero: string): boolean {
        // Algoritmo de Luhn
        return true;
    }
}

class ProcessadorPix implements ProcessadorPagamento {
    processar(dados: DadosPagamento): ResultadoPagamento {
        // Gera QR Code e chave PIX
        return { sucesso: true, qrCode: 'xxx', chave: 'yyy' };
    }
}

class ProcessadorBoleto implements ProcessadorPagamento {
    processar(dados: DadosPagamento): ResultadoPagamento {
        // Gera boleto banc√°rio
        return { sucesso: true, linhaDigitavel: 'xxx', pdf: 'yyy' };
    }
}

// RESPONSABILIDADE: Gerenciar o ciclo de vida de pedidos
class ServicoPedido {
    constructor(
        private repositorio: PedidoRepository,
        private calculadora: CalculadoraPedido,
        private gerenciadorEstoque: GerenciadorEstoque,
        private processadorPagamento: ProcessadorPagamento,
        private notificador: ServicoNotificacao
    ) {}
    
    criar(usuarioId: string, items: ItemPedido[], metodoPagamento: string): Pedido {
        // Validar disponibilidade
        if (!this.gerenciadorEstoque.verificarDisponibilidade(items)) {
            throw new Error('Produtos indispon√≠veis');
        }
        
        // Calcular valores
        const subtotal = this.calculadora.calcularSubtotal(items);
        const frete = this.calculadora.calcularFrete('30000000', 5);
        const total = subtotal + frete;
        
        // Criar pedido
        const pedido = new Pedido(usuarioId, items, total);
        this.repositorio.salvar(pedido);
        
        // Reservar estoque
        this.gerenciadorEstoque.reservar(items);
        
        // Processar pagamento
        const resultado = this.processadorPagamento.processar({
            pedidoId: pedido.id,
            valor: total,
            metodo: metodoPagamento
        });
        
        if (resultado.sucesso) {
            pedido.marcarComoPago();
            this.notificador.enviarConfirmacao(usuarioId, pedido);
        }
        
        return pedido;
    }
}

// RESPONSABILIDADE: Enviar notifica√ß√µes multicanal
class ServicoNotificacao {
    constructor(
        private emailSender: EmailSender,
        private smsSender: SmsSender,
        private pushSender: PushNotificationSender
    ) {}
    
    enviarConfirmacao(usuarioId: string, pedido: Pedido): void {
        const usuario = this.buscarUsuario(usuarioId);
        
        this.emailSender.enviar({
            para: usuario.email,
            assunto: 'Pedido Confirmado',
            corpo: this.gerarEmailConfirmacao(pedido)
        });
        
        if (usuario.telefone) {
            this.smsSender.enviar(
                usuario.telefone,
                `Pedido ${pedido.id} confirmado!`
            );
        }
    }
    
    private gerarEmailConfirmacao(pedido: Pedido): string {
        // Template de email
        return `Seu pedido ${pedido.id} foi confirmado...`;
    }
    
    private buscarUsuario(id: string): Usuario {
        // Busca usu√°rio
        return null as any;
    }
}

// RESPONSABILIDADE: Gerar relat√≥rios de neg√≥cio
class GeradorRelatorios {
    constructor(
        private pedidoRepository: PedidoRepository,
        private exportadorCSV: ExportadorCSV
    ) {}
    
    gerarRelatorioVendas(dataInicio: Date, dataFim: Date): RelatorioVendas {
        const pedidos = this.pedidoRepository.buscarPorPeriodo(
            dataInicio,
            dataFim
        );
        
        return {
            totalVendas: pedidos.reduce((sum, p) => sum + p.total, 0),
            quantidadePedidos: pedidos.length,
            ticketMedio: this.calcularTicketMedio(pedidos),
            produtosMaisVendidos: this.identificarMaisVendidos(pedidos)
        };
    }
    
    exportarCSV(relatorio: RelatorioVendas): string {
        return this.exportadorCSV.exportar(relatorio);
    }
    
    private calcularTicketMedio(pedidos: Pedido[]): number {
        if (pedidos.length === 0) return 0;
        const total = pedidos.reduce((sum, p) => sum + p.total, 0);
        return total / pedidos.length;
    }
    
    private identificarMaisVendidos(pedidos: Pedido[]): ProdutoVendas[] {
        // Implementa√ß√£o
        return [];
    }
}
```

#### Passo 3: Aplicar Dependency Injection

```typescript
// Container de Depend√™ncias (exemplo com InversifyJS)
class ContainerEcommerce {
    static configurar(): Container {
        const container = new Container();
        
        // Repositories
        container.bind(ProdutoRepository).toSelf();
        container.bind(UsuarioRepository).toSelf();
        container.bind(PedidoRepository).toSelf();
        container.bind(EstoqueRepository).toSelf();
        
        // Services
        container.bind(CatalogoProdutos).toSelf();
        container.bind(GerenciadorEstoque).toSelf();
        container.bind(ServicoAutenticacao).toSelf();
        container.bind(CalculadoraPedido).toSelf();
        container.bind(ServicoPedido).toSelf();
        container.bind(ServicoNotificacao).toSelf();
        container.bind(GeradorRelatorios).toSelf();
        
        // Pagamento
        container.bind(ProcessadorPagamento)
            .to(ProcessadorCartaoCredito)
            .whenTargetNamed('cartao');
        container.bind(ProcessadorPagamento)
            .to(ProcessadorPix)
            .whenTargetNamed('pix');
        
        return container;
    }
}

// Uso
const container = ContainerEcommerce.configurar();
const servicoPedido = container.get(ServicoPedido);
const pedido = servicoPedido.criar(usuarioId, items, 'cartao');
```

### 4.3 Resultados do Refactoring

| M√©trica | Antes (God Object) | Depois (SRP) | Melhoria |
|---------|-------------------|--------------|----------|
| Linhas por classe | ~1200 | ~80-150 | **88% redu√ß√£o** |
| Responsabilidades | 8+ | 1 por classe | **Isolamento completo** |
| Testabilidade | Baixa (mock complexo) | Alta (mocks simples) | **Testes 5x mais r√°pidos** |
| Tempo para adicionar feature | ~8 horas | ~2 horas | **75% mais r√°pido** |
| Bugs por mudan√ßa | 3-5 | 0-1 | **80% redu√ß√£o** |
| Acoplamento (dependencies) | 15+ | 2-4 | **73% redu√ß√£o** |
| Cobertura de testes | 30% | 85% | **183% aumento** |

---

## 5. Abstra√ß√µes Conceituais

### 5.1 SRP e Acoplamento (Coupling)

O **acoplamento** mede o grau de interdepend√™ncia entre m√≥dulos. O SRP reduz o acoplamento ao isolar responsabilidades.

#### Tipos de Acoplamento

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  N√≠veis de Acoplamento (do pior para o melhor)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. Acoplamento de Conte√∫do    (Content Coupling)      ‚îÇ
‚îÇ     ‚îî‚îÄ Uma classe modifica dados internos de outra     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  2. Acoplamento Comum          (Common Coupling)        ‚îÇ
‚îÇ     ‚îî‚îÄ M√∫ltiplas classes compartilham dados globais    ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  3. Acoplamento de Controle    (Control Coupling)       ‚îÇ
‚îÇ     ‚îî‚îÄ Uma classe controla o fluxo de outra            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  4. Acoplamento de Dados       (Data Coupling)          ‚îÇ
‚îÇ     ‚îî‚îÄ Classes compartilham apenas dados simples       ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  5. Acoplamento de Mensagem    (Message Coupling) ‚úÖ    ‚îÇ
‚îÇ     ‚îî‚îÄ Classes se comunicam via interfaces/mensagens   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Exemplo: Reduzindo Acoplamento com SRP

```python
# ‚ùå Alto Acoplamento (viola SRP)
class ProcessadorPagamento:
    def processar(self, pedido):
        # Acoplamento direto com banco de dados
        conn = mysql.connector.connect(host='localhost', user='root')
        cursor = conn.cursor()
        
        # Acoplamento direto com API externa
        response = requests.post('https://api.pagamento.com/charge', 
                                 json={'amount': pedido.total})
        
        # Acoplamento direto com email
        smtp = smtplib.SMTP('smtp.gmail.com', 587)
        smtp.send_message(f'Pagamento processado: {pedido.id}')
        
        # Acoplamento direto com log
        with open('pagamentos.log', 'a') as f:
            f.write(f'{datetime.now()}: Pedido {pedido.id} processado\n')

# ‚úÖ Baixo Acoplamento (segue SRP)
class ProcessadorPagamento:
    def __init__(self, 
                 repositorio: PedidoRepository,
                 gateway: PaymentGateway,
                 notificador: Notificador,
                 logger: Logger):
        self.repositorio = repositorio
        self.gateway = gateway
        self.notificador = notificador
        self.logger = logger
    
    def processar(self, pedido: Pedido) -> ResultadoPagamento:
        resultado = self.gateway.cobrar(pedido.total)
        
        if resultado.sucesso:
            self.repositorio.atualizar_status(pedido.id, 'PAGO')
            self.notificador.enviar_confirmacao(pedido)
            self.logger.info(f'Pagamento processado: {pedido.id}')
        
        return resultado
```

**Benef√≠cios:**
- Depend√™ncias expl√≠citas (via construtor)
- F√°cil substitui√ß√£o de implementa√ß√µes (mock para testes)
- Cada depend√™ncia tem responsabilidade √∫nica
- Menor impacto de mudan√ßas

### 5.2 SRP e Modularidade

A **modularidade** √© a capacidade de decompor um sistema em m√≥dulos independentes e intercambi√°veis.

#### Princ√≠pios de Modularidade Refor√ßados pelo SRP

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              CARACTER√çSTICAS MODULARES                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                       ‚îÇ
‚îÇ  üîí ENCAPSULAMENTO                                   ‚îÇ
‚îÇ     ‚îî‚îÄ Cada m√≥dulo esconde detalhes de implementa√ß√£o‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  üîå INTERFACES CLARAS                                ‚îÇ
‚îÇ     ‚îî‚îÄ Contratos bem definidos entre m√≥dulos        ‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  ‚ôªÔ∏è  REUSABILIDADE                                    ‚îÇ
‚îÇ     ‚îî‚îÄ M√≥dulos podem ser usados em contextos diversos‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  üß© COMPOSI√á√ÉO                                        ‚îÇ
‚îÇ     ‚îî‚îÄ M√≥dulos podem ser combinados de v√°rias formas‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  üîÑ SUBSTITUIBILIDADE                                ‚îÇ
‚îÇ     ‚îî‚îÄ M√≥dulos podem ser trocados sem impacto global‚îÇ
‚îÇ                                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Exemplo: Sistema Modular com SRP

```java
// M√≥dulo de Autentica√ß√£o
public interface Autenticador {
    Usuario autenticar(Credenciais credenciais);
}

public class AutenticadorJWT implements Autenticador {
    private final UsuarioRepository repository;
    private final GeradorToken geradorToken;
    
    public Usuario autenticar(Credenciais credenciais) {
        Usuario usuario = repository.buscarPorEmail(credenciais.email());
        if (verificarSenha(usuario, credenciais.senha())) {
            String token = geradorToken.gerar(usuario);
            return usuario.comToken(token);
        }
        throw new AutenticacaoException("Credenciais inv√°lidas");
    }
}

// M√≥dulo de Autoriza√ß√£o
public interface Autorizador {
    boolean temPermissao(Usuario usuario, String recurso, String acao);
}

public class AutorizadorRBAC implements Autorizador {
    private final PermissaoRepository repository;
    
    public boolean temPermissao(Usuario usuario, String recurso, String acao) {
        Set<String> papeis = usuario.getPapeis();
        return repository.buscarPermissoes(papeis)
            .stream()
            .anyMatch(p -> p.permite(recurso, acao));
    }
}

// M√≥dulo de Valida√ß√£o
public interface Validador<T> {
    ResultadoValidacao validar(T entidade);
}

public class ValidadorUsuario implements Validador<Usuario> {
    private final List<Regra<Usuario>> regras;
    
    public ResultadoValidacao validar(Usuario usuario) {
        List<String> erros = new ArrayList<>();
        
        for (Regra<Usuario> regra : regras) {
            if (!regra.avaliar(usuario)) {
                erros.add(regra.getMensagemErro());
            }
        }
        
        return erros.isEmpty() 
            ? ResultadoValidacao.sucesso()
            : ResultadoValidacao.falha(erros);
    }
}

// Composi√ß√£o Modular
public class ServicoUsuario {
    private final Autenticador autenticador;
    private final Autorizador autorizador;
    private final Validador<Usuario> validador;
    private final UsuarioRepository repository;
    
    public Usuario criar(DadosUsuario dados, Usuario criador) {
        // Autoriza√ß√£o
        if (!autorizador.temPermissao(criador, "usuarios", "criar")) {
            throw new AutorizacaoException("Sem permiss√£o");
        }
        
        // Valida√ß√£o
        Usuario novoUsuario = Usuario.de(dados);
        ResultadoValidacao resultado = validador.validar(novoUsuario);
        if (!resultado.valido()) {
            throw new ValidacaoException(resultado.getErros());
        }
        
        // Persist√™ncia
        return repository.salvar(novoUsuario);
    }
}
```

### 5.3 SRP e Coes√£o

**Coes√£o** √© a medida de qu√£o fortemente relacionados os elementos de um m√≥dulo est√£o.

#### N√≠veis de Coes√£o (do pior para o melhor)

| Tipo | Descri√ß√£o | Exemplo | Avalia√ß√£o |
|------|-----------|---------|-----------|
| **Coincidental** | Elementos agrupados arbitrariamente | `Utilidades` com m√©todos aleat√≥rios | ‚ùå Muito ruim |
| **L√≥gica** | Elementos relacionados por categoria geral | `Validadores` misturando diferentes contextos | ‚ùå Ruim |
| **Temporal** | Elementos que executam no mesmo momento | `Inicializador` que faz tudo no startup | ‚ö†Ô∏è Question√°vel |
| **Procedural** | Elementos que seguem uma sequ√™ncia | `Pipeline` de processamento | ‚ö†Ô∏è Aceit√°vel |
| **Comunicacional** | Elementos que operam nos mesmos dados | `GerenciadorProduto` | ‚úÖ Bom |
| **Sequencial** | Sa√≠da de um √© entrada de outro | `ProcessadorPedido` em pipeline | ‚úÖ Muito bom |
| **Funcional** | Elementos contribuem para uma √∫nica tarefa | `CalculadoraDesconto` | ‚úÖ Excelente |

```csharp
// ‚ùå Coes√£o Coincidental (viola SRP)
public class Utilidades
{
    public static string FormatarCPF(string cpf) { }
    public static void EnviarEmail(string destinatario) { }
    public static decimal CalcularJuros(decimal valor) { }
    public static bool ValidarJSON(string json) { }
}

// ‚úÖ Coes√£o Funcional (segue SRP)
public class FormatadorDocumento
{
    public string FormatarCPF(string cpf) 
    {
        return $"{cpf.Substring(0,3)}.{cpf.Substring(3,3)}." +
               $"{cpf.Substring(6,3)}-{cpf.Substring(9,2)}";
    }
    
    public string FormatarCNPJ(string cnpj) { }
}

public class CalculadoraFinanceira
{
    public decimal CalcularJurosSimples(decimal valor, decimal taxa, int meses)
    {
        return valor * taxa * meses / 100;
    }
    
    public decimal CalcularJurosCompostos(decimal valor, decimal taxa, int meses)
    {
        return valor * Math.Pow(1 + taxa / 100, meses) - valor;
    }
}
```

---

## 6. SRP e os Princ√≠pios SOLID

### 6.1 Vis√£o Geral da Interdepend√™ncia

```
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   SOLID PRINCIPLES                  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                             ‚îÇ
        ‚ñº                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     SRP      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§     OCP      ‚îÇ
‚îÇ  (Foundation)‚îÇ              ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                             ‚îÇ
       ‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ         ‚îÇ
       ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        LSP           ‚îÇ
‚îÇ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îî‚îÄ‚îÄ‚î§     ISP       ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ     DIP       ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 6.2 SRP como Base para OCP (Open/Closed Principle)

**OCP**: "Entidades de software devem estar abertas para extens√£o, mas fechadas para modifica√ß√£o."

O SRP √© **pr√©-requisito** para o OCP:

```typescript
// ‚ùå Viola SRP e OCP
class ProcessadorPagamento {
    processar(pedido: Pedido, tipo: string) {
        if (tipo === 'cartao') {
            // L√≥gica cart√£o
            this.validarCartao();
            this.cobrarCartao();
        } else if (tipo === 'boleto') {
            // L√≥gica boleto
            this.gerarBoleto();
        } else if (tipo === 'pix') {
            // L√≥gica PIX
            this.gerarQRCode();
        }
        // Adicionar novo m√©todo = modificar esta classe (viola OCP)
    }
}

// ‚úÖ Segue SRP e OCP
interface MetodoPagamento {
    processar(valor: number): ResultadoPagamento;
}

class PagamentoCartao implements MetodoPagamento {
    processar(valor: number): ResultadoPagamento {
        // Apenas responsabilidade de cart√£o
        return this.cobrarCartao(valor);
    }
}

class PagamentoBoleto implements MetodoPagamento {
    processar(valor: number): ResultadoPagamento {
        // Apenas responsabilidade de boleto
        return this.gerarBoleto(valor);
    }
}

class PagamentoPix implements MetodoPagamento {
    processar(valor: number): ResultadoPagamento {
        // Apenas responsabilidade de PIX
        return this.gerarQRCode(valor);
    }
}

// Adicionar novo m√©todo = criar nova classe (segue OCP)
class PagamentoCriptomoeda implements MetodoPagamento {
    processar(valor: number): ResultadoPagamento {
        return this.processarBlockchain(valor);
    }
}

class ProcessadorPagamento {
    constructor(private metodo: MetodoPagamento) {}
    
    processar(pedido: Pedido): ResultadoPagamento {
        return this.metodo.processar(pedido.total);
    }
}
```

**Como SRP habilita OCP:**
1. Classes com responsabilidade √∫nica s√£o naturalmente **extens√≠veis**
2. N√£o h√° "l√≥gica condicional" que precise ser modificada
3. Novas funcionalidades = novas classes, n√£o modifica√ß√£o de existentes

### 6.3 SRP e ISP (Interface Segregation Principle)

**ISP**: "Clientes n√£o devem ser for√ßados a depender de interfaces que n√£o usam."

O SRP em classes leva ao ISP em interfaces:

```java
// ‚ùå Interface "gorda" (viola ISP e SRP)
public interface Trabalhador {
    void trabalhar();
    void comer();
    void dormir();
    void receberSalario();
    void pedirFerias();
    void fazerRelatorio();
}

// ‚úÖ Interfaces segregadas (segue ISP e SRP)
public interface Trabalhavel {
    void trabalhar();
}

public interface Alimentavel {
    void comer();
}

public interface Descansavel {
    void dormir();
}

public interface Remuneravel {
    void receberSalario();
}

// Classes implementam apenas o que precisam
public class Robo implements Trabalhavel {
    // Rob√¥ n√£o come, n√£o dorme, n√£o recebe sal√°rio
    public void trabalhar() { }
}

public class Funcionario implements Trabalhavel, Alimentavel, 
                                     Descansavel, Remuneravel {
    public void trabalhar() { }
    public void comer() { }
    public void dormir() { }
    public void receberSalario() { }
}
```

### 6.4 SRP e LSP (Liskov Substitution Principle)

**LSP**: "Subtipos devem ser substitu√≠veis por seus tipos base."

SRP facilita LSP ao evitar classes com m√∫ltiplas responsabilidades conflitantes:

```python
# ‚ùå Viola LSP (e SRP)
class Passaro:
    def voar(self):
        print("Voando...")
    
    def nadar(self):
        print("Nadando...")

class Pinguim(Passaro):
    def voar(self):
        # Pinguim n√£o voa! Viola LSP
        raise Exception("Pinguins n√£o voam!")

# ‚úÖ Segue LSP e SRP
class Passaro:
    def mover(self):
        pass

class PassaroVoador(Passaro):
    def voar(self):
        print("Voando...")

class PassaroNadador(Passaro):
    def nadar(self):
        print("Nadando...")

class Aguia(PassaroVoador):
    def voar(self):
        print("√Åguia voando alto...")

class Pinguim(PassaroNadador):
    def nadar(self):
        print("Pinguim nadando...")
```

### 6.5 SRP e DIP (Dependency Inversion Principle)

**DIP**: "Dependa de abstra√ß√µes, n√£o de implementa√ß√µes concretas."

SRP + DIP = arquitetura altamente desacoplada:

```go
// ‚ùå Viola SRP e DIP
type PedidoService struct {}

func (s *PedidoService) ProcessarPedido(pedido Pedido) {
    // Depend√™ncia concreta de MySQL
    db, _ := sql.Open("mysql", "user:pass@/dbname")
    db.Exec("INSERT INTO pedidos ...")
    
    // Depend√™ncia concreta de SMTP
    smtp, _ := net.Dial("tcp", "smtp.gmail.com:587")
    // ...
}

// ‚úÖ Segue SRP e DIP
type PedidoRepository interface {
    Salvar(pedido Pedido) error
}

type Notificador interface {
    Enviar(destinatario string, mensagem string) error
}

type PedidoService struct {
    repository  PedidoRepository  // Abstra√ß√£o
    notificador Notificador       // Abstra√ß√£o
}

func (s *PedidoService) ProcessarPedido(pedido Pedido) error {
    // Depende de abstra√ß√µes, n√£o implementa√ß√µes
    if err := s.repository.Salvar(pedido); err != nil {
        return err
    }
    return s.notificador.Enviar(pedido.Cliente.Email, "Pedido confirmado")
}

// Implementa√ß√µes concretas
type MySQLPedidoRepository struct {
    db *sql.DB
}

func (r *MySQLPedidoRepository) Salvar(pedido Pedido) error {
    _, err := r.db.Exec("INSERT INTO pedidos ...")
    return err
}

type EmailNotificador struct {
    smtpHost string
}

func (n *EmailNotificador) Enviar(destinatario, mensagem string) error {
    // Implementa√ß√£o SMTP
    return nil
}
```

---

## 7. Armadilhas Comuns

### 7.1 Over-Engineering: Separa√ß√£o Excessiva

**Problema**: Criar classes demais, tornando o c√≥digo dif√≠cil de navegar.

```ruby
# ‚ùå Exagero na separa√ß√£o
class UsuarioNomeValidator
  def validar(nome)
    nome.length >= 3
  end
end

class UsuarioEmailValidator
  def validar(email)
    email.include?('@')
  end
end

class UsuarioIdadeValidator
  def validar(idade)
    idade >= 18
  end
end

class UsuarioCPFValidator
  def validar(cpf)
    cpf.length == 11
  end
end

# Agora temos 4 classes para valida√ß√£o simples!

# ‚úÖ Equil√≠brio adequado
class UsuarioValidator
  def validar(usuario)
    erros = []
    erros << "Nome muito curto" if usuario.nome.length < 3
    erros << "Email inv√°lido" unless usuario.email.include?('@')
    erros << "Idade m√≠nima 18 anos" if usuario.idade < 18
    erros << "CPF inv√°lido" if usuario.cpf.length != 11
    erros
  end
end
```

**Regra de Ouro**: Separe quando as valida√ß√µes tiverem **motivos diferentes para mudar** (ex: regras de neg√≥cio vs formato t√©cnico).

### 7.2 Dificuldade em Definir "Responsabilidade"

**Problema**: Ambiguidade sobre o que constitui "uma responsabilidade".

#### Framework para Definir Responsabilidade

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PERGUNTAS PARA IDENTIFICAR RESPONSABILIDADE           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                         ‚îÇ
‚îÇ  1Ô∏è‚É£  Quem solicitaria mudan√ßas nesta classe?          ‚îÇ
‚îÇ     ‚îú‚îÄ Um stakeholder? ‚úÖ Uma responsabilidade         ‚îÇ
‚îÇ     ‚îî‚îÄ M√∫ltiplos? ‚ùå M√∫ltiplas responsabilidades      ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  2Ô∏è‚É£  Posso descrever a classe em uma frase sem "e"?   ‚îÇ
‚îÇ     ‚îú‚îÄ "Valida usu√°rios" ‚úÖ                            ‚îÇ
‚îÇ     ‚îî‚îÄ "Valida E salva E notifica" ‚ùå                  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  3Ô∏è‚É£  Os m√©todos operam nos mesmos dados?              ‚îÇ
‚îÇ     ‚îú‚îÄ Sim, alta coes√£o ‚úÖ                             ‚îÇ
‚îÇ     ‚îî‚îÄ N√£o, baixa coes√£o ‚ùå                            ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  4Ô∏è‚É£  Mudan√ßas em um m√©todo afetam outros?             ‚îÇ
‚îÇ     ‚îú‚îÄ Sim, acoplamento interno ‚ö†Ô∏è                     ‚îÇ
‚îÇ     ‚îî‚îÄ N√£o, independentes ‚úÖ                           ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  5Ô∏è‚É£  Posso testar cada m√©todo isoladamente?           ‚îÇ
‚îÇ     ‚îú‚îÄ Sim ‚úÖ                                          ‚îÇ
‚îÇ     ‚îî‚îÄ N√£o, depend√™ncias complexas ‚ùå                  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 7.3 SRP em Arquiteturas em Camadas

**Desafio**: Aplicar SRP em sistemas com m√∫ltiplas camadas (Presentation, Business, Data).

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            ARQUITETURA EM CAMADAS + SRP                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ  ‚îÇ  PRESENTATION LAYER                         ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ UserController (HTTP)                  ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ UserPresenter (Formata√ß√£o)             ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ UserViewModel (DTO)                    ‚îÇ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ                      ‚îÇ                                   ‚îÇ
‚îÇ                      ‚ñº                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ  ‚îÇ  APPLICATION LAYER                          ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ CreateUserUseCase                      ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ AuthenticateUserUseCase                ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ UpdateUserProfileUseCase               ‚îÇ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ                      ‚îÇ                                   ‚îÇ
‚îÇ                      ‚ñº                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ  ‚îÇ  DOMAIN LAYER                               ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ User (Entity)                           ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ UserValidator (Business Rules)         ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ UserRepository (Interface)             ‚îÇ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ                      ‚îÇ                                   ‚îÇ
‚îÇ                      ‚ñº                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ  ‚îÇ  INFRASTRUCTURE LAYER                       ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ MySQLUserRepository (Implementation)   ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ EmailService                            ‚îÇ        ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ CacheService                            ‚îÇ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ                                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Cada camada tem responsabilidade √∫nica:**
- **Presentation**: Interface com usu√°rio
- **Application**: Orquestra√ß√£o de casos de uso
- **Domain**: L√≥gica de neg√≥cio
- **Infrastructure**: Detalhes t√©cnicos

### 7.4 SRP em Microsservi√ßos

**Desafio**: Definir boundaries de responsabilidade em arquitetura distribu√≠da.

```
üè¢ Sistema de E-commerce (Microsservi√ßos)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Cat√°logo   ‚îÇ  ‚îÇ   Pedidos    ‚îÇ  ‚îÇ  Pagamento   ‚îÇ
‚îÇ   Service    ‚îÇ  ‚îÇ   Service    ‚îÇ  ‚îÇ   Service    ‚îÇ
‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ - Produtos   ‚îÇ  ‚îÇ - Criar      ‚îÇ  ‚îÇ - Processar  ‚îÇ
‚îÇ - Categorias ‚îÇ  ‚îÇ - Atualizar  ‚îÇ  ‚îÇ - Validar    ‚îÇ
‚îÇ - Busca      ‚îÇ  ‚îÇ - Cancelar   ‚îÇ  ‚îÇ - Estornar   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   Message Bus (Kafka) ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Princ√≠pio**: Cada microsservi√ßo = Uma responsabilidade de neg√≥cio (Bounded Context do DDD).

### 7.5 Classes Utilit√°rias e SRP

**Problema comum**: Classes `Utils` que violam SRP.

```kotlin
// ‚ùå Classe Utils gen√©rica (viola SRP)
object Utils {
    fun formatarCPF(cpf: String): String { }
    fun validarEmail(email: String): Boolean { }
    fun calcularIdade(dataNascimento: Date): Int { }
    fun gerarHash(senha: String): String { }
    fun converterParaJSON(obj: Any): String { }
}

// ‚úÖ Classes especializadas (segue SRP)
object FormatadorDocumento {
    fun formatarCPF(cpf: String): String { }
    fun formatarCNPJ(cnpj: String): String { }
}

object ValidadorEmail {
    fun validar(email: String): Boolean {
        return email.matches(Regex("[^@]+@[^@]+\\.[^@]+"))
    }
}

object CalculadoraIdade {
    fun calcular(dataNascimento: LocalDate): Int {
        return Period.between(dataNascimento, LocalDate.now()).years
    }
}

object GeradorHash {
    fun gerar(senha: String): String {
        return BCrypt.hashpw(senha, BCrypt.gensalt())
    }
}
```

---

## 8. Impacto na Qualidade do Software

### 8.1 Manutenibilidade

**Antes do SRP:**
```
Mudan√ßa solicitada: "Alterar formato do relat√≥rio de PDF para Excel"

Impacto:
‚îú‚îÄ Modificar classe GerenciadorRelatorio (250 linhas)
‚îú‚îÄ Risco de quebrar c√°lculos (mesma classe)
‚îú‚îÄ Risco de quebrar persist√™ncia (mesma classe)
‚îú‚îÄ Necess√°rio testar TUDO novamente
‚îî‚îÄ Tempo estimado: 8 horas
```

**Depois do SRP:**
```
Mudan√ßa solicitada: "Alterar formato do relat√≥rio de PDF para Excel"

Impacto:
‚îú‚îÄ Criar nova classe: ExcelReportFormatter (50 linhas)
‚îú‚îÄ Implementar interface ReportFormatter
‚îú‚îÄ Trocar depend√™ncia no container DI
‚îú‚îÄ Testar apenas novo formatter
‚îî‚îÄ Tempo estimado: 2 horas
```

**M√©tricas de Manutenibilidade:**

| M√©trica | Sem SRP | Com SRP | Melhoria |
|---------|---------|---------|----------|
| Tempo m√©dio para corre√ß√£o de bug | 4h | 1h | **75%** |
| Linhas alteradas por mudan√ßa | 120 | 25 | **79%** |
| Risco de regress√£o | Alto | Baixo | **Significativa** |
| Facilidade de entendimento (1-10) | 4 | 8 | **100%** |

### 8.2 Testabilidade

```csharp
// ‚ùå Dif√≠cil de testar (viola SRP)
public class ServicoUsuario
{
    public void CriarUsuario(string nome, string email)
    {
        // L√≥gica de valida√ß√£o
        if (string.IsNullOrEmpty(nome)) throw new Exception();
        
        // Acesso direto ao banco
        using var conn = new SqlConnection("Server=...");
        conn.Execute("INSERT INTO...");
        
        // Envio de email
        var smtp = new SmtpClient("smtp.gmail.com");
        smtp.Send("Bem-vindo!");
        
        // Log
        File.AppendText("log.txt").WriteLine($"Usu√°rio {nome} criado");
    }
}

// Para testar: precisa de banco real, servidor SMTP, sistema de arquivos

// ‚úÖ F√°cil de testar (segue SRP)
public class ServicoUsuario
{
    private readonly IValidador validador;
    private readonly IUsuarioRepository repository;
    private readonly INotificador notificador;
    private readonly ILogger logger;
    
    [Fact]
    public void DeveLancarExcecao_QuandoNomeInvalido()
    {
        // Arrange
        var validadorMock = new Mock<IValidador>();
        validadorMock.Setup(v => v.Validar(It.IsAny<Usuario>()))
                     .Returns(false);
        
        var servico = new ServicoUsuario(
            validadorMock.Object,
            Mock.Of<IUsuarioRepository>(),
            Mock.Of<INotificador>(),
            Mock.Of<ILogger>()
        );
        
        // Act & Assert
        Assert.Throws